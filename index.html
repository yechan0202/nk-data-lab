<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>NK Data Lab</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h1 { color: #222; }
    .section { margin-top: 30px; }
    .card { padding: 15px; border: 1px solid #ddd; margin-top: 10px; border-radius: 8px; }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    ul { padding-left: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #eee; padding: 8px; font-size: 13px; }
    th { background: #f8f8f8; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    input, select, button { padding: 6px 8px; font-size: 13px; }
  </style>
</head>
<body>

<h1>North Korea Data Lab</h1>
<p>Interactive access to structured datasets on DPRK sanctions, diplomacy, and related domains.</p>

<div class="section">
  <h2>Sanctions Timeline Panel (2006â€“Present)</h2>
  <p>Monthly coded UN Security Council sanctions resolutions affecting DPRK. Each row is sourced from the UN 1718 Sanctions Committee resolutions list (see link column).</p>

  <div class="controls">
    <select id="filter-year"><option value="">Year</option></select>
    <input id="filter-resolution" placeholder="Resolution (e.g., 2397)" />
    <input id="search" placeholder="Search text (e.g., oil)" />
    <button id="reset" type="button">Reset</button>
  </div>

  <div class="card">
    <table id="table"></table>
  </div>
  <div class="card">
    <small>Data file: <a href="data/sanctions_timeline_panel.csv">sanctions_timeline_panel.csv</a></small>
  </div>
</div>

<div class="section">
  <h2>Other datasets (under construction)</h2>
  <div class="card">
    <strong>Trade (UN Comtrade)</strong><br/>
    <small>Import/export flows (DPRK) for time series analysis.</small>
  </div>
  <div class="card">
    <strong>Night-time lights (NOAA VIIRS)</strong><br/>
    <small>Night-light intensity as proxy for economic activity and infrastructure.</small>
  </div>
  <div class="card">
    <strong>Missile launches (CSIS Missile Threat)</strong><br/>
    <small>Event-level launch database.</small>
  </div>
  <div class="card">
    <strong>Humanitarian financing (OCHA FTS)</strong><br/>
    <small>Humanitarian funding flows by year.</small>
  </div>
</div>

<div class="section">
  <h2>Source links</h2>
  <ul>
    <li><a href="https://www.un.org/securitycouncil/sanctions/1718/materials">UN 1718 Sanctions Committee materials</a></li>
    <li><a href="https://www.un.org/securitycouncil/sanctions/1718/panel-of-experts/reports">UN Panel of Experts on DPRK reports</a></li>
    <li><a href="https://ofac.treasury.gov/sanctions-programs-and-country-information/north-korea-sanctions">US OFAC North Korea sanctions</a></li>
    <li><a href="https://www.sanctionsmap.eu/#/main/details/17">EU sanctions map (DPRK)</a></li>
    <li><a href="https://www.gov.uk/government/publications/the-uk-sanctions-list">UK sanctions list</a></li>
    <li><a href="https://comtrade.un.org/">UN Comtrade</a></li>
    <li><a href="https://eogdata.mines.edu/nighttime_light/">NOAA VIIRS night-time lights</a></li>
    <li><a href="https://missilethreat.csis.org/country/dprk/">CSIS Missile Threat</a></li>
    <li><a href="https://fts.unocha.org/">OCHA FTS</a></li>
  </ul>
</div>

<script>
async function load() {
  try {
    const resp = await fetch('data/sanctions_timeline_panel.csv');
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const text = await resp.text();
    const parsed = Papa.parse(text, {header: true, skipEmptyLines: true});
    if (parsed.errors && parsed.errors.length) {
      console.warn('CSV parse errors:', parsed.errors.slice(0, 5));
    }
    const data = parsed.data.filter(row => row.year);
    window._data = data;
    setupFilters(data);
    render(data);
  } catch (err) {
    document.getElementById('table').innerHTML = '<tbody><tr><td colspan="7">Failed to load dataset: ' + err.message + '</td></tr></tbody>';
    console.error(err);
  }
}

function setupFilters(data) {
  const yearSel = document.getElementById('filter-year');
  const years = Array.from(new Set(data.map(d => d.year))).sort();
  years.forEach(y => {
    const o = document.createElement('option');
    o.value = o.textContent = y;
    yearSel.appendChild(o);
  });

  document.getElementById('reset').onclick = () => {
    yearSel.value = '';
    document.getElementById('filter-resolution').value = '';
    document.getElementById('search').value = '';
    render(window._data);
  };

  yearSel.onchange = apply;
  document.getElementById('filter-resolution').oninput = apply;
  document.getElementById('search').oninput = apply;
}

function apply() {
  const year = document.getElementById('filter-year').value;
  const res = document.getElementById('filter-resolution').value.trim().toLowerCase();
  const q = document.getElementById('search').value.trim().toLowerCase();

  let d = window._data;
  if (year) d = d.filter(x => x.year === year);
  if (res) d = d.filter(x => (x.resolution || '').toLowerCase().includes(res));
  if (q) d = d.filter(x => Object.values(x).some(v => String(v).toLowerCase().includes(q)));
  render(d);
}

function render(data) {
  const table = document.getElementById('table');
  table.innerHTML = '';

  const headers = ['year', 'month', 'resolution', 'sanction_type', 'target_sector', 'new_or_expansion', 'source_url'];
  const thead = document.createElement('thead');
  const trh = document.createElement('tr');
  headers.forEach(h => {
    const th = document.createElement('th');
    th.textContent = h;
    trh.appendChild(th);
  });
  thead.appendChild(trh);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  data.forEach(row => {
    const tr = document.createElement('tr');
    headers.forEach(h => {
      const td = document.createElement('td');
      const val = row[h] || '';
      if (h === 'source_url') {
        const a = document.createElement('a');
        a.href = val;
        a.textContent = 'link';
        a.target = '_blank';
        td.appendChild(a);
      } else {
        td.textContent = val;
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
}

load();
</script>

</body>
</html>
